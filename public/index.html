<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Diamond Free Fire</title>
<style>
  body {
    margin: 0;
    font-family: 'Arial', sans-serif;
    background: radial-gradient(ellipse at center, #000 0%, #111 100%);
    color: #fff;
  }
  .container { padding: 20px; max-width: 900px; margin: auto; }
  h1,h2,h3 { text-align: center; color: #0ff; }
  button {
    background: linear-gradient(45deg,#0ff,#00f);
    color: #fff;
    border: none;
    padding: 10px 20px;
    margin: 5px;
    cursor: pointer;
    font-weight: bold;
    border-radius: 8px;
    transition: transform 0.2s, box-shadow 0.2s;
  }
  button:hover {
    transform: scale(1.05);
    box-shadow: 0 0 15px #0ff;
  }
  input { padding: 8px; border-radius: 5px; border: none; margin-right: 5px; }
  table {
    width: 100%; border-collapse: collapse; margin-top: 20px;
  }
  th, td {
    border: 1px solid #0ff; padding: 8px; text-align: center;
  }
  th { background-color: #111; }
  .message {
    background: #111; padding: 10px; margin: 5px 0; border-radius: 5px;
  }
</style>
</head>
<body>
<div class="container">
  <h1>Diamond Free Fire</h1>

  <div id="loginDiv">
    <input type="text" id="playerName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
    <button onclick="login()">–í–æ–π—Ç–∏</button>
  </div>

  <div id="playerDiv" style="display:none;">
    <h2 id="welcome"></h2>
    <p>–ê–ª–º–∞–∑—ã: <span id="diamonds">0</span> | FF –ê–ª–º–∞–∑—ã: <span id="ffDiamonds">0</span> | –£—Ä–æ–≤–µ–Ω—å: <span id="level">1</span></p>
    
    <button onclick="collect()">–°–æ–±—Ä–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã</button>

    <h3>–û–±–º–µ–Ω –∞–ª–º–∞–∑–æ–≤ –Ω–∞ FF –∞–ª–º–∞–∑—ã</h3>
    <input type="number" id="exchangeAmount" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ FFüíé">
    <button onclick="exchange()">–û–±–º–µ–Ω—è—Ç—å</button>
    <p id="exchangeResult"></p>

    <h3>–û–Ω–ª–∞–π–Ω –∏–≥—Ä–æ–∫–∏ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –º–∏–Ω)</h3>
    <ul id="onlinePlayers"></ul>

    <h3>–¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤</h3>
    <table>
      <thead>
        <tr>
          <th>–ò–≥—Ä–æ–∫</th><th>–ê–ª–º–∞–∑—ã</th><th>FF –ê–ª–º–∞–∑—ã</th><th>–£—Ä–æ–≤–µ–Ω—å</th>
        </tr>
      </thead>
      <tbody id="leaderboard"></tbody>
    </table>

    <h3>–ü–æ—á—Ç–∞</h3>
    <div id="messages"></div>

    <button onclick="goAdmin()">–ü–µ—Ä–µ–π—Ç–∏ –≤ –∞–¥–º–∏–Ω–∫—É</button>
  </div>
</div>

<script>
let currentPlayer = localStorage.getItem('playerName') || '';

if(currentPlayer) login();

async function login(){
  const nameInput = document.getElementById('playerName');
  const name = nameInput.value || currentPlayer;
  if(!name) return alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è!');

  const res = await fetch('/login', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({name})
  });
  const data = await res.json();
  currentPlayer = name;
  localStorage.setItem('playerName', name);

  document.getElementById('loginDiv').style.display = 'none';
  document.getElementById('playerDiv').style.display = 'block';
  nameInput.value = '';
  updatePlayer(data);
  loadLeaderboard();
  loadMessages();
  loadOnline();
}

function updatePlayer(data){
  document.getElementById('welcome').innerText = `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${data.name}`;
  document.getElementById('diamonds').innerText = data.diamonds;
  document.getElementById('ffDiamonds').innerText = data.ffDiamonds;
  document.getElementById('level').innerText = data.level;
}

async function collect(){
  const res = await fetch('/collect', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({name: currentPlayer})
  });
  const data = await res.json();
  if(data.error) alert(data.error);
  else updatePlayer(data);
  loadLeaderboard();
}

async function exchange(){
  const amount = Number(document.getElementById('exchangeAmount').value);
  if(!amount || amount <= 0) return alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ');
  const res = await fetch('/login', { // –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({name: currentPlayer})
  });
  const player = await res.json();
  const cost = amount*1500;
  if(player.diamonds < cost) return alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–ª–º–∞–∑–æ–≤');
  
  const modify = await fetch('/admin/modify', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({name: currentPlayer, diamonds:-cost, ffDiamonds:amount, message:`–í—ã –æ–±–º–µ–Ω—è–ª–∏ ${cost} üíé –Ω–∞ ${amount} FFüíé`})
  });
  const updated = await modify.json();
  updatePlayer(updated);
  document.getElementById('exchangeResult').innerText = `–í—ã —É—Å–ø–µ—à–Ω–æ –æ–±–º–µ–Ω—è–ª–∏ ${cost} üíé –Ω–∞ ${amount} FFüíé`;
  loadMessages();
  loadLeaderboard();
}

async function loadLeaderboard(){
  const res = await fetch('/leaderboard');
  const data = await res.json();
  const tbody = document.getElementById('leaderboard');
  tbody.innerHTML = '';
  data.forEach(p=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${p.name}</td><td>${p.diamonds}</td><td>${p.ffDiamonds}</td><td>${p.level}</td>`;
    tbody.appendChild(tr);
  });
}

async function loadMessages(){
  const res = await fetch(`/messages?name=${currentPlayer}`);
  const data = await res.json();
  const div = document.getElementById('messages');
  div.innerHTML = '';
  data.forEach(m=>{
    const el = document.createElement('div');
    el.className='message';
    el.innerText = m;
    div.appendChild(el);
  });
}

async function loadOnline(){
  // –î–ª—è –ø—Ä–∏–º–µ—Ä–∞ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
  const res = await fetch('/leaderboard');
  const data = await res.json();
  const ul = document.getElementById('onlinePlayers');
  ul.innerHTML='';
  data.forEach(p=>{
    const li = document.createElement('li');
    li.innerText = p.name;
    ul.appendChild(li);
  });
}

function goAdmin(){
  window.location.href = '/admin.html';
}
</script>
</body>
</html>
