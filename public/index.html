<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Diamond Free Fire</title>
<style>
body {
  font-family: 'Arial', sans-serif;
  background: url('https://i.ibb.co/6mQ9T8S/cosmos.jpg') no-repeat center center fixed;
  background-size: cover;
  color: #fff;
  text-align: center;
}
button {
  padding: 10px 20px;
  margin: 10px;
  font-size: 16px;
  cursor: pointer;
  border: none;
  border-radius: 5px;
  background: #00f0ff;
  color: #000;
}
#messages {
  background: rgba(0,0,0,0.5);
  margin: 10px auto;
  padding: 10px;
  width: 300px;
  border-radius: 5px;
}
</style>
</head>
<body>
<h1>Diamond Free Fire</h1>
<div>
  <input type="text" id="playerName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
  <button onclick="login()">–í–æ–π—Ç–∏</button>
</div>
<div id="playerInfo" style="display:none;">
  <p>–ê–ª–º–∞–∑—ã: <span id="diamonds">0</span></p>
  <p>FF –ê–ª–º–∞–∑—ã: <span id="ffDiamonds">0</span></p>
  <p>–£—Ä–æ–≤–µ–Ω—å: <span id="level">1</span></p>
  <button onclick="collect()">–°–æ–±—Ä–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã</button>
  <button onclick="openAdmin()">–ê–¥–º–∏–Ω–∫–∞</button>
  <h3>–û–Ω–ª–∞–π–Ω –∏–≥—Ä–æ–∫–∏</h3>
  <ul id="leaderboard"></ul>
  <h3>–ü–æ—á—Ç–∞ ‚úâÔ∏è</h3>
  <div id="messages"></div>
</div>
<script>
let currentPlayer = '';

async function login() {
  const name = document.getElementById('playerName').value;
  if (!name) return alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è');
  const res = await fetch('/login', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({name}) });
  const data = await res.json();
  currentPlayer = data.name;
  document.getElementById('playerInfo').style.display='block';
  updatePlayer(data);
  loadLeaderboard();
  loadMessages();
}

async function collect() {
  const res = await fetch('/collect', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({name: currentPlayer}) });
  const data = await res.json();
  if(data.error) alert(data.error);
  updatePlayer(data);
  loadLeaderboard();
}

function updatePlayer(data){
  document.getElementById('diamonds').innerText = data.diamonds;
  document.getElementById('ffDiamonds').innerText = data.ffDiamonds;
  document.getElementById('level').innerText = data.level;
}

async function loadLeaderboard(){
  const res = await fetch('/leaderboard');
  const list = await res.json();
  const lb = document.getElementById('leaderboard');
  lb.innerHTML = '';
  list.forEach(p => lb.innerHTML += `<li>${p.name}: ${p.diamonds} üíé | ${p.ffDiamonds} FFüíé</li>`);
}

function openAdmin(){
  window.location.href = 'admin.html';
}

async function loadMessages(){
  const res = await fetch(`/messages/${currentPlayer}`);
  const messages = await res.json();
  const div = document.getElementById('messages');
  div.innerHTML = messages.map(m=>`<p>${m.date}: ${m.text}</p>`).join('');
}
</script>
</body>
</html>
